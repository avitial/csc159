<h3>Lab Tools Exercise 3 - GNU Debugger (GDB)</h3>

<p>
The purpose of this exercise is to practice <tt>GDB</tt> which will
help you in no small ways afterward. The lab manual contains a brief
overview of GDB. There are online GDB manual and reference chart linked
from the class webpage.
<p>
Use the shell command <tt>script</tt> to "record" this exercise
to submit with those files you will be making in exercise 3, as the
total submission required to complete phase 1. The shell command <i>
typescript</i> records the shell session until you enter <tt>exit</tt>.
What has been recorded will be in a text file "typescript."

<ol>
<li>
Read the Chapters on Debugging, Flash, and GDB in the Lab Manual.
<p>
<li>
In your own login directory, make a new directory named <i>lab2</i>
and copy "sample.c" from <i>lab1</i> to <em>lab2</em> for this exercise.
<p>
<li>
Make the following changes.
<p>
(a) Add a loop around the output statements (<em>after</em> the initial value
of the variable "i=111" is set) which executes the displays five times.
<br>
(b) Each time around the loop, increment the value of "i" by one. Thus the
program should print consecutive messages showing the value of "i" changing
from 111 to 115.
<p>
<li>
Use <b>make</b> to compile and link the program. The default
<em>Makefile</em> generated by <b>spede-mkmf -q</b> automatically includes
the necessary debugging information.
<p>
<li>
Use the command<br>
<p>
"<b>vi --cmd "set number" sample.c</b>" shows line number in vi.
(Enter ":" then "set number" in vi also activates line number dispalys,
and "set nonumber" turns it off.) This helps when debugging.
<p>

<!--
<li>Invoke Flash to download MyOS.dli, and invoke Flint to enter FLAMES.
<p>
<li>
Experiment with some of the basic FLAMES commands:
try <TT>?</TT>, <TT>D</TT>, <TT>CPU, DEV</TT>, <TT>M</TT>, and <TT>R</TT>
(refer to the Lab Manual Chapter on FLAMES).
<p>
<li>
Use the Flames "<b>g</b>" command to execute your program and verify it works.
<p>
<li>
Press the <em>reset</em> button on the target machine to reset it, then
restart Flames on the target machine. Use "flash MyOS.dli" and "d" (like
described above) on the workstation to download your program again.
<p>
-->

<li>At the shell prompt, download MyOS.dli via Flash: <b>flash MyOS.dli</b>
and enter <b>d</b> or <b>download</b> at the Flash prompt.
<p>
<li>
At the Flash prompt, enter the command <b>g</b> or <b>gdb</b> or <b>debug</b>
to start up the GDB source-level debugger.
GDB will start running and the stop at an &quot;automatic breakpoint&quot;
at the beginning of your program, the main() function.</li>
<p>
<li>Use the GDB command<br>
<p>
<b>b &#160;<em>filename</em>:<em>linenum</em></b>
<p>
to set a breakpoint on the first statement <em>after</em> the statement in
the main program which assigns the numeric value 111 to the variable "i."
Use your printed, line-numbered listings to determine the correct location
(line number) for the breakpoint. Without <em>filename:</em> in front of
the <em>linenum</em>, it's the default file containing the main() function.
<p>
<li>
Add a subroutine <b>DisplayMsg()</b> that has the two output statements
move in from main().
Easily set another breakpoint at the function by <b>b DisplayMsg</b>.
<p>
<li>
Use the GDB command <b>c</b> or <b>continue</b>. The program should
immediately run and stop at the breakpoint you just set. (Before
executing that line.)
<p>
<li>
After the breakpoint is taken, display the current value of the variable
"i" using the <b>p i</b> or <b>print i</b>.
<p>
<li>
Once you have observed the correct variable value (111), use GDB to change
the value to something like "111." Variable values can be set in GDB
using the <b>set var=(value)</b> statement, e.g., "<b>set var i=111</b>."
<p>
<li>
Enter "<b>where</b>" to see the call stack at the current breakpoint.
<p>
<li>
Continue execution of the loop and verify results, i.e., verify by
displaying the value of "i," and it should increment correctly each time
it breaks/stops in the loop.
<p>
<li>
Quit GDB using the <b>quit</b> command, download the program again, and
restart GDB. Re-run the program from the start, this time with a
<em>conditional</em> breakpoint on one of the statements inside the loop:
e.g., <b>break sample.c:17 if i == 113</b> (suppose line 17 is the line in
your program loop that is suitable for the test). The GDB will stop at
that line when i happens to be 113.
<p>
<li>
GDB contains many useful commands. You should at least be fluent at
using the following ones:
<ul>
<li>
<b>list</b>, <b>list (line number)</b>, or <b>list (filename:line number)</b>
to list source code from the GDB prompt.
<li>
<b>next</b>, which executes source code one statement at a time, but won't
step into a subroutine (will execute it as a single line).
<li>
<b>step</b>, which executes source code one line at a time, and step into
a subroutine if it's called.
<li>
<b>info b</b>, which gives information on breakpoints.
<li>
<b>info reg</b>, which gives information on register values.
<li>
<b>where</b>, which displays the current program calling chain (tells
the calling sequence).
<li>
<b>delete 2</b>, used to remove breakpoint number 2.
<li>
<b>clear</b>, used to remove all breakpoints.
</ul>
</ol>
